{"ast":null,"code":"import _asyncToGenerator from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";function _regeneratorRuntime(){\"use strict\";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return exports;};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol=\"function\"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||\"@@iterator\",asyncIteratorSymbol=$Symbol.asyncIterator||\"@@asyncIterator\",toStringTagSymbol=$Symbol.toStringTag||\"@@toStringTag\";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key];}try{define({},\"\");}catch(err){define=function define(obj,key,value){return obj[key]=value;};}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state=\"suspendedStart\";return function(method,arg){if(\"executing\"===state)throw new Error(\"Generator is already running\");if(\"completed\"===state){if(\"throw\"===method)throw arg;return doneResult();}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult;}}if(\"next\"===context.method)context.sent=context._sent=context.arg;else if(\"throw\"===context.method){if(\"suspendedStart\"===state)throw state=\"completed\",context.arg;context.dispatchException(context.arg);}else\"return\"===context.method&&context.abrupt(\"return\",context.arg);state=\"executing\";var record=tryCatch(innerFn,self,context);if(\"normal\"===record.type){if(state=context.done?\"completed\":\"suspendedYield\",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done};}\"throw\"===record.type&&(state=\"completed\",context.method=\"throw\",context.arg=record.arg);}};}(innerFn,self,context),generator;}function tryCatch(fn,obj,arg){try{return{type:\"normal\",arg:fn.call(obj,arg)};}catch(err){return{type:\"throw\",arg:err};}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,function(){return this;});var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){[\"next\",\"throw\",\"return\"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg);});});}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(\"throw\"!==record.type){var result=record.arg,value=result.value;return value&&\"object\"==typeof value&&hasOwn.call(value,\"__await\")?PromiseImpl.resolve(value.__await).then(function(value){invoke(\"next\",value,resolve,reject);},function(err){invoke(\"throw\",err,resolve,reject);}):PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result);},function(error){return invoke(\"throw\",error,resolve,reject);});}reject(record.arg);}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject);});}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();};}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(undefined===method){if(context.delegate=null,\"throw\"===context.method){if(delegate.iterator.return&&(context.method=\"return\",context.arg=undefined,maybeInvokeDelegate(delegate,context),\"throw\"===context.method))return ContinueSentinel;context.method=\"throw\",context.arg=new TypeError(\"The iterator does not provide a 'throw' method\");}return ContinueSentinel;}var record=tryCatch(method,delegate.iterator,context.arg);if(\"throw\"===record.type)return context.method=\"throw\",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,\"return\"!==context.method&&(context.method=\"next\",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method=\"throw\",context.arg=new TypeError(\"iterator result is not an object\"),context.delegate=null,ContinueSentinel);}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry);}function resetTryEntry(entry){var record=entry.completion||{};record.type=\"normal\",delete record.arg,entry.completion=record;}function Context(tryLocsList){this.tryEntries=[{tryLoc:\"root\"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0);}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if(\"function\"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;){if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;}return next.value=undefined,next.done=!0,next;};return next.next=next;}}return{next:doneResult};}function doneResult(){return{value:undefined,done:!0};}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,\"constructor\",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,\"constructor\",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,\"GeneratorFunction\"),exports.isGeneratorFunction=function(genFun){var ctor=\"function\"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||\"GeneratorFunction\"===(ctor.displayName||ctor.name));},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,\"GeneratorFunction\")),genFun.prototype=Object.create(Gp),genFun;},exports.awrap=function(arg){return{__await:arg};},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,function(){return this;}),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next();});},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,\"Generator\"),define(Gp,iteratorSymbol,function(){return this;}),define(Gp,\"toString\",function(){return\"[object Generator]\";}),exports.keys=function(object){var keys=[];for(var key in object){keys.push(key);}return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next;}return next.done=!0,next;};},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method=\"next\",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this){\"t\"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined);}},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if(\"throw\"===rootRecord.type)throw rootRecord.arg;return this.rval;},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type=\"throw\",record.arg=exception,context.next=loc,caught&&(context.method=\"next\",context.arg=undefined),!!caught;}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if(\"root\"===entry.tryLoc)return handle(\"end\");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,\"catchLoc\"),hasFinally=hasOwn.call(entry,\"finallyLoc\");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);}else{if(!hasFinally)throw new Error(\"try statement without catch or finally\");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,\"finallyLoc\")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break;}}finallyEntry&&(\"break\"===type||\"continue\"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method=\"next\",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record);},complete:function complete(record,afterLoc){if(\"throw\"===record.type)throw record.arg;return\"break\"===record.type||\"continue\"===record.type?this.next=record.arg:\"return\"===record.type?(this.rval=this.arg=record.arg,this.method=\"return\",this.next=\"end\"):\"normal\"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel;},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel;}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(\"throw\"===record.type){var thrown=record.arg;resetTryEntry(entry);}return thrown;}}throw new Error(\"illegal catch attempt\");},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},\"next\"===this.method&&(this.arg=undefined),ContinueSentinel;}},exports;}import _ from'lodash';import Trezor from\"../../services/Trezor\";var _require=require('events'),EventEmitter=_require.EventEmitter;var ethUtil=require('ethereumjs-util');var HDKey=require('hdkey');var TrezorConnect=require('trezor-connect').default;var hdPathString=\"m/44'/60'/0'/0\";var keyringType='Trezor Hardware';var pathBase='m';var MAX_INDEX=1000;var DELAY_BETWEEN_POPUPS=1000;var TREZOR_CONNECT_MANIFEST={email:'support@dnerochain.org',appUrl:'https://wallet.dnerochain.org',keepSession:true};var TrezorKeyring=/*#__PURE__*/function(_EventEmitter){_inherits(TrezorKeyring,_EventEmitter);var _super=_createSuper(TrezorKeyring);function TrezorKeyring(){var _this;var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,TrezorKeyring);_this=_super.call(this);_this.type=keyringType;_this.accounts=[];_this.hdk=new HDKey();_this.page=0;_this.perPage=5;_this.unlockedAccount=0;_this.paths={};_this.deserialize(opts);TrezorConnect.manifest(TREZOR_CONNECT_MANIFEST);return _this;}_createClass(TrezorKeyring,[{key:\"serialize\",value:function serialize(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts,page:this.page,paths:this.paths,perPage:this.perPage,unlockedAccount:this.unlockedAccount});}},{key:\"deserialize\",value:function deserialize(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.hdPath=opts.hdPath||hdPathString;this.accounts=opts.accounts||[];this.page=opts.page||0;this.perPage=opts.perPage||5;return Promise.resolve();}},{key:\"isUnlocked\",value:function isUnlocked(){return!!(this.hdk&&this.hdk.publicKey);}},{key:\"unlock\",value:function unlock(){var _this2=this;if(this.isUnlocked())return Promise.resolve('already unlocked');return new Promise(function(resolve,reject){TrezorConnect.getPublicKey({path:_this2.hdPath,coin:'ETH'}).then(function(response){if(response.success){_this2.hdk.publicKey=new Buffer(response.payload.publicKey,'hex');_this2.hdk.chainCode=new Buffer(response.payload.chainCode,'hex');resolve('just unlocked');}else{reject(new Error(response.payload&&response.payload.error||'Unknown error'));}}).catch(function(e){reject(new Error(e&&e.toString()||'Unknown error'));});});}},{key:\"setAccountToUnlock\",value:function setAccountToUnlock(index){this.unlockedAccount=parseInt(index,10);}},{key:\"addAccounts\",value:function addAccounts(){var _this3=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return new Promise(function(resolve,reject){_this3.unlock().then(function(_){var from=_this3.unlockedAccount;var to=from+n;_this3.accounts=[];for(var i=from;i<to;i++){var address=_this3._addressFromIndex(pathBase,i);_this3.accounts.push(address);_this3.page=0;}resolve(_this3.accounts);}).catch(function(e){reject(e);});});}},{key:\"getFirstPage\",value:function getFirstPage(){this.page=0;return this._getPage(1);}},{key:\"getNextPage\",value:function getNextPage(){return this._getPage(1);}},{key:\"getPreviousPage\",value:function getPreviousPage(){return this._getPage(-1);}},{key:\"_getPage\",value:function _getPage(increment){var _this4=this;this.page+=increment;if(this.page<=0){this.page=1;}return new Promise(function(resolve,reject){_this4.unlock().then(function(_){var from=(_this4.page-1)*_this4.perPage;var to=from+_this4.perPage;var accounts=[];for(var i=from;i<to;i++){var address=_this4._addressFromIndex(pathBase,i);accounts.push({address:address,balance:null,index:i});_this4.paths[ethUtil.toChecksumAddress(address)]=i;}resolve(accounts);}).catch(function(e){reject(e);});});}},{key:\"getAccounts\",value:function getAccounts(){return Promise.resolve(this.accounts.slice());}},{key:\"removeAccount\",value:function removeAccount(address){if(!this.accounts.map(function(a){return a.toLowerCase();}).includes(address.toLowerCase())){throw new Error(\"Address \".concat(address,\" not found in this keyring\"));}this.accounts=this.accounts.filter(function(a){return a.toLowerCase()!==address.toLowerCase();});}},{key:\"signAndSendTransaction\",value:function(){var _signAndSendTransaction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(fromAddress,transaction,provider){var unlockResult,sequence,signedTxRaw,result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.unlock();case 2:unlockResult=_context.sent;if(!_.isNil(transaction.getSequenceOverride())){_context.next=9;break;}_context.next=6;return provider.getTransactionCount(fromAddress);case 6:sequence=_context.sent;sequence=sequence+1;transaction.setSequence(sequence);case 9:transaction.setFrom(ethUtil.toChecksumAddress(fromAddress));_context.next=12;return Trezor.signTransaction(transaction);case 12:signedTxRaw=_context.sent;result=provider.sendTransaction(signedTxRaw);return _context.abrupt(\"return\",Promise.resolve(result));case 15:case\"end\":return _context.stop();}}},_callee,this);}));function signAndSendTransaction(_x,_x2,_x3){return _signAndSendTransaction.apply(this,arguments);}return signAndSendTransaction;}()},{key:\"signMessage\",value:function signMessage(withAccount,data){return Promise.reject(new Error('Not supported on this device'));}// For personal_sign, we need to prefix the message:\n},{key:\"signPersonalMessage\",value:function signPersonalMessage(withAccount,message){return Promise.reject(new Error('Not supported on this device'));}},{key:\"signTypedData\",value:function signTypedData(withAccount,typedData){// Waiting on trezor to enable this\nreturn Promise.reject(new Error('Not supported on this device'));}},{key:\"exportAccount\",value:function exportAccount(address){return Promise.reject(new Error('Not supported on this device'));}},{key:\"forgetDevice\",value:function forgetDevice(){this.accounts=[];this.hdk=new HDKey();this.page=0;this.unlockedAccount=0;this.paths={};}/* PRIVATE METHODS */},{key:\"_normalize\",value:function _normalize(buf){return ethUtil.bufferToHex(buf).toString();}},{key:\"_addressFromIndex\",value:function _addressFromIndex(pathBase,i){var dkey=this.hdk.derive(\"\".concat(pathBase,\"/\").concat(i));var address=ethUtil.publicToAddress(dkey.publicKey,true).toString('hex');return ethUtil.toChecksumAddress(address).toLowerCase();}},{key:\"_pathFromAddress\",value:function _pathFromAddress(address){var checksummedAddress=ethUtil.toChecksumAddress(address);var index=this.paths[checksummedAddress];if(typeof index==='undefined'){for(var i=0;i<MAX_INDEX;i++){if(checksummedAddress===this._addressFromIndex(pathBase,i)){index=i;break;}}}if(typeof index==='undefined'){throw new Error('Unknown address');}return\"\".concat(this.hdPath,\"/\").concat(index);}}]);return TrezorKeyring;}(EventEmitter);TrezorKeyring.type=keyringType;export default TrezorKeyring;","map":{"version":3,"names":["_","Trezor","require","EventEmitter","ethUtil","HDKey","TrezorConnect","default","hdPathString","keyringType","pathBase","MAX_INDEX","DELAY_BETWEEN_POPUPS","TREZOR_CONNECT_MANIFEST","email","appUrl","keepSession","TrezorKeyring","opts","type","accounts","hdk","page","perPage","unlockedAccount","paths","deserialize","manifest","Promise","resolve","hdPath","publicKey","isUnlocked","reject","getPublicKey","path","coin","then","response","success","Buffer","payload","chainCode","Error","error","catch","e","toString","index","parseInt","n","unlock","from","to","i","address","_addressFromIndex","push","_getPage","increment","balance","toChecksumAddress","slice","map","a","toLowerCase","includes","filter","fromAddress","transaction","provider","unlockResult","isNil","getSequenceOverride","getTransactionCount","sequence","setSequence","setFrom","signTransaction","signedTxRaw","result","sendTransaction","withAccount","data","message","typedData","buf","bufferToHex","dkey","derive","publicToAddress","checksummedAddress"],"sources":["/Users/jjestrella/DNERO_Protocol/dnerowebwallet/src/keyrings/trezor/index.js"],"sourcesContent":["import _ from 'lodash';\nimport Trezor from \"../../services/Trezor\";\nconst { EventEmitter } = require('events')\nconst ethUtil = require('ethereumjs-util')\nconst HDKey = require('hdkey')\nconst TrezorConnect = require('trezor-connect').default\nconst hdPathString = `m/44'/60'/0'/0`\nconst keyringType = 'Trezor Hardware'\nconst pathBase = 'm'\nconst MAX_INDEX = 1000\nconst DELAY_BETWEEN_POPUPS = 1000\nconst TREZOR_CONNECT_MANIFEST = {\n    email: 'support@dnerochain.org',\n    appUrl: 'https://wallet.dnerochain.org',\n    keepSession: true\n};\n\nclass TrezorKeyring extends EventEmitter {\n    constructor (opts = {}) {\n        super()\n        this.type = keyringType\n        this.accounts = []\n        this.hdk = new HDKey()\n        this.page = 0\n        this.perPage = 5\n        this.unlockedAccount = 0\n        this.paths = {}\n        this.deserialize(opts)\n        TrezorConnect.manifest(TREZOR_CONNECT_MANIFEST)\n    }\n\n    serialize () {\n        return Promise.resolve({\n            hdPath: this.hdPath,\n            accounts: this.accounts,\n            page: this.page,\n            paths: this.paths,\n            perPage: this.perPage,\n            unlockedAccount: this.unlockedAccount,\n        })\n    }\n\n    deserialize (opts = {}) {\n        this.hdPath = opts.hdPath || hdPathString\n        this.accounts = opts.accounts || []\n        this.page = opts.page || 0\n        this.perPage = opts.perPage || 5\n        return Promise.resolve()\n    }\n\n    isUnlocked () {\n        return !!(this.hdk && this.hdk.publicKey)\n    }\n\n    unlock () {\n        if (this.isUnlocked()) return Promise.resolve('already unlocked')\n        return new Promise((resolve, reject) => {\n            TrezorConnect.getPublicKey({\n                path: this.hdPath,\n                coin: 'ETH',\n            }).then(response => {\n                if (response.success) {\n                    this.hdk.publicKey = new Buffer(response.payload.publicKey, 'hex')\n                    this.hdk.chainCode = new Buffer(response.payload.chainCode, 'hex')\n                    resolve('just unlocked')\n                } else {\n                    reject(new Error(response.payload && response.payload.error || 'Unknown error'))\n                }\n            }).catch(e => {\n                reject(new Error(e && e.toString() || 'Unknown error'))\n            })\n        })\n    }\n\n    setAccountToUnlock (index) {\n        this.unlockedAccount = parseInt(index, 10)\n    }\n\n    addAccounts (n = 1) {\n        return new Promise((resolve, reject) => {\n            this.unlock()\n                .then(_ => {\n                    const from = this.unlockedAccount\n                    const to = from + n\n                    this.accounts = []\n\n                    for (let i = from; i < to; i++) {\n                        const address = this._addressFromIndex(pathBase, i)\n                        this.accounts.push(address)\n                        this.page = 0\n                    }\n                    resolve(this.accounts)\n                })\n                .catch(e => {\n                    reject(e)\n                })\n        })\n    }\n\n    getFirstPage () {\n        this.page = 0\n        return this._getPage(1)\n    }\n\n    getNextPage () {\n        return this._getPage(1)\n    }\n\n    getPreviousPage () {\n        return this._getPage(-1)\n    }\n\n    _getPage (increment) {\n        this.page += increment\n\n        if (this.page <= 0) { this.page = 1 }\n\n        return new Promise((resolve, reject) => {\n            this.unlock()\n                .then(_ => {\n\n                    const from = (this.page - 1) * this.perPage\n                    const to = from + this.perPage\n\n                    const accounts = []\n\n                    for (let i = from; i < to; i++) {\n                        const address = this._addressFromIndex(pathBase, i)\n                        accounts.push({\n                            address: address,\n                            balance: null,\n                            index: i,\n                        })\n                        this.paths[ethUtil.toChecksumAddress(address)] = i\n\n                    }\n                    resolve(accounts)\n                })\n                .catch(e => {\n                    reject(e)\n                })\n        })\n    }\n\n    getAccounts () {\n        return Promise.resolve(this.accounts.slice())\n    }\n\n    removeAccount (address) {\n        if (!this.accounts.map(a => a.toLowerCase()).includes(address.toLowerCase())) {\n            throw new Error(`Address ${address} not found in this keyring`)\n        }\n        this.accounts = this.accounts.filter(a => a.toLowerCase() !== address.toLowerCase())\n    }\n\n    async signAndSendTransaction (fromAddress, transaction, provider) {\n        const unlockResult = await this.unlock();\n\n        if(_.isNil(transaction.getSequenceOverride())){\n            let sequence = await provider.getTransactionCount(fromAddress);\n            sequence = sequence + 1;\n            transaction.setSequence(sequence);\n        }\n        transaction.setFrom(ethUtil.toChecksumAddress(fromAddress));\n        const signedTxRaw = await Trezor.signTransaction(transaction);\n        const result = provider.sendTransaction(signedTxRaw);\n\n        return Promise.resolve(result);\n    }\n\n    signMessage (withAccount, data) {\n        return Promise.reject(new Error('Not supported on this device'))\n    }\n\n    // For personal_sign, we need to prefix the message:\n    signPersonalMessage (withAccount, message) {\n        return Promise.reject(new Error('Not supported on this device'))\n    }\n\n    signTypedData (withAccount, typedData) {\n        // Waiting on trezor to enable this\n        return Promise.reject(new Error('Not supported on this device'))\n    }\n\n    exportAccount (address) {\n        return Promise.reject(new Error('Not supported on this device'))\n    }\n\n    forgetDevice () {\n        this.accounts = []\n        this.hdk = new HDKey()\n        this.page = 0\n        this.unlockedAccount = 0\n        this.paths = {}\n    }\n\n    /* PRIVATE METHODS */\n\n    _normalize (buf) {\n        return ethUtil.bufferToHex(buf).toString()\n    }\n\n    _addressFromIndex (pathBase, i) {\n        const dkey = this.hdk.derive(`${pathBase}/${i}`)\n        const address = ethUtil\n            .publicToAddress(dkey.publicKey, true)\n            .toString('hex');\n        return ethUtil.toChecksumAddress(address).toLowerCase()\n    }\n\n    _pathFromAddress (address) {\n        const checksummedAddress = ethUtil.toChecksumAddress(address)\n        let index = this.paths[checksummedAddress]\n        if (typeof index === 'undefined') {\n            for (let i = 0; i < MAX_INDEX; i++) {\n                if (checksummedAddress === this._addressFromIndex(pathBase, i)) {\n                    index = i\n                    break\n                }\n            }\n        }\n\n        if (typeof index === 'undefined') {\n            throw new Error('Unknown address')\n        }\n        return `${this.hdPath}/${index}`\n    }\n}\n\nTrezorKeyring.type = keyringType;\n\nexport default TrezorKeyring;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}