{"ast":null,"code":"import _asyncToGenerator from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/jjestrella/DNERO_Protocol/dnerowebwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";function _regeneratorRuntime(){\"use strict\";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return exports;};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol=\"function\"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||\"@@iterator\",asyncIteratorSymbol=$Symbol.asyncIterator||\"@@asyncIterator\",toStringTagSymbol=$Symbol.toStringTag||\"@@toStringTag\";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key];}try{define({},\"\");}catch(err){define=function define(obj,key,value){return obj[key]=value;};}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state=\"suspendedStart\";return function(method,arg){if(\"executing\"===state)throw new Error(\"Generator is already running\");if(\"completed\"===state){if(\"throw\"===method)throw arg;return doneResult();}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult;}}if(\"next\"===context.method)context.sent=context._sent=context.arg;else if(\"throw\"===context.method){if(\"suspendedStart\"===state)throw state=\"completed\",context.arg;context.dispatchException(context.arg);}else\"return\"===context.method&&context.abrupt(\"return\",context.arg);state=\"executing\";var record=tryCatch(innerFn,self,context);if(\"normal\"===record.type){if(state=context.done?\"completed\":\"suspendedYield\",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done};}\"throw\"===record.type&&(state=\"completed\",context.method=\"throw\",context.arg=record.arg);}};}(innerFn,self,context),generator;}function tryCatch(fn,obj,arg){try{return{type:\"normal\",arg:fn.call(obj,arg)};}catch(err){return{type:\"throw\",arg:err};}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,function(){return this;});var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){[\"next\",\"throw\",\"return\"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg);});});}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(\"throw\"!==record.type){var result=record.arg,value=result.value;return value&&\"object\"==typeof value&&hasOwn.call(value,\"__await\")?PromiseImpl.resolve(value.__await).then(function(value){invoke(\"next\",value,resolve,reject);},function(err){invoke(\"throw\",err,resolve,reject);}):PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result);},function(error){return invoke(\"throw\",error,resolve,reject);});}reject(record.arg);}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject);});}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();};}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(undefined===method){if(context.delegate=null,\"throw\"===context.method){if(delegate.iterator.return&&(context.method=\"return\",context.arg=undefined,maybeInvokeDelegate(delegate,context),\"throw\"===context.method))return ContinueSentinel;context.method=\"throw\",context.arg=new TypeError(\"The iterator does not provide a 'throw' method\");}return ContinueSentinel;}var record=tryCatch(method,delegate.iterator,context.arg);if(\"throw\"===record.type)return context.method=\"throw\",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,\"return\"!==context.method&&(context.method=\"next\",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method=\"throw\",context.arg=new TypeError(\"iterator result is not an object\"),context.delegate=null,ContinueSentinel);}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry);}function resetTryEntry(entry){var record=entry.completion||{};record.type=\"normal\",delete record.arg,entry.completion=record;}function Context(tryLocsList){this.tryEntries=[{tryLoc:\"root\"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0);}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if(\"function\"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;){if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;}return next.value=undefined,next.done=!0,next;};return next.next=next;}}return{next:doneResult};}function doneResult(){return{value:undefined,done:!0};}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,\"constructor\",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,\"constructor\",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,\"GeneratorFunction\"),exports.isGeneratorFunction=function(genFun){var ctor=\"function\"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||\"GeneratorFunction\"===(ctor.displayName||ctor.name));},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,\"GeneratorFunction\")),genFun.prototype=Object.create(Gp),genFun;},exports.awrap=function(arg){return{__await:arg};},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,function(){return this;}),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next();});},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,\"Generator\"),define(Gp,iteratorSymbol,function(){return this;}),define(Gp,\"toString\",function(){return\"[object Generator]\";}),exports.keys=function(object){var keys=[];for(var key in object){keys.push(key);}return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next;}return next.done=!0,next;};},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method=\"next\",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this){\"t\"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined);}},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if(\"throw\"===rootRecord.type)throw rootRecord.arg;return this.rval;},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type=\"throw\",record.arg=exception,context.next=loc,caught&&(context.method=\"next\",context.arg=undefined),!!caught;}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if(\"root\"===entry.tryLoc)return handle(\"end\");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,\"catchLoc\"),hasFinally=hasOwn.call(entry,\"finallyLoc\");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);}else{if(!hasFinally)throw new Error(\"try statement without catch or finally\");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,\"finallyLoc\")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break;}}finallyEntry&&(\"break\"===type||\"continue\"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method=\"next\",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record);},complete:function complete(record,afterLoc){if(\"throw\"===record.type)throw record.arg;return\"break\"===record.type||\"continue\"===record.type?this.next=record.arg:\"return\"===record.type?(this.rval=this.arg=record.arg,this.method=\"return\",this.next=\"end\"):\"normal\"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel;},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel;}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(\"throw\"===record.type){var thrown=record.arg;resetTryEntry(entry);}return thrown;}}throw new Error(\"illegal catch attempt\");},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},\"next\"===this.method&&(this.arg=undefined),ContinueSentinel;}},exports;}import ObservableStore from'../utils/ObservableStore';import*as dnerojs from'@dnerolabs/dnero-js';import{nanoid}from'nanoid';import _ from\"lodash\";import BigNumber from\"bignumber.js\";var _require=require('events'),EventEmitter=_require.EventEmitter;var TransactionsController=/*#__PURE__*/function(_EventEmitter){_inherits(TransactionsController,_EventEmitter);var _super=_createSuper(TransactionsController);function TransactionsController(opts){var _this;_classCallCheck(this,TransactionsController);_this=_super.call(this);var initState=_objectSpread({},opts.initState);_this.store=new ObservableStore(initState);_this.memStore=new ObservableStore({transactionRequests:[],transactions:{}});_this.preferencesController=opts.preferencesController;_this.signAndSendTransaction=opts.signAndSendTransaction;_this._getProvider=opts.getProvider;_this._updateAccounts=opts.updateAccounts;_this.pendingTransactionRequests=new Map();return _this;}_createClass(TransactionsController,[{key:\"_getTransactionRequests\",value:function _getTransactionRequests(){return this.memStore.getState().transactionRequests||[];}},{key:\"_setTransactionRequests\",value:function _setTransactionRequests(transactionRequests){this.memStore.updateState({transactionRequests:transactionRequests});}},{key:\"_addTransactionRequest\",value:function _addTransactionRequest(request,resolve,reject){var transactionRequests=this._getTransactionRequests();transactionRequests.push(request);this._setTransactionRequests(transactionRequests);this.pendingTransactionRequests.set(request.id,{request:request,resolve:resolve,reject:reject});return true;}},{key:\"_removeTransactionRequest\",value:function _removeTransactionRequest(transactionRequestId){var transactionRequests=this._getTransactionRequests();transactionRequests=transactionRequests.filter(function(tx){return tx.id!==transactionRequestId;});this._setTransactionRequests(transactionRequests);delete this.pendingTransactionRequests[transactionRequestId];return true;}},{key:\"_getTransactionRequest\",value:function _getTransactionRequest(transactionRequestId){var transactionRequests=this._getTransactionRequests();return transactionRequests.find(function(tx){return tx.id===transactionRequestId;});}/**\n     * Validates and generates a txMeta with defaults and puts it in txStateManager\n     * store.\n     *\n     * @returns {Object}\n     */},{key:\"addTransactionRequest\",value:function(){var _addTransactionRequest2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(transactionRequest){var _this2=this;var fromAddress,transaction,gasFeeData,transactionDepJson,transactionDep,depGasFeeData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:fromAddress=this.preferencesController.getSelectedAddress();transaction=dnerojs.transactions.transactionFromJson(transactionRequest);transaction.setFrom(fromAddress);_context.next=5;return this.getEstimatedGasData(transaction);case 5:gasFeeData=_context.sent;transactionDepJson=(transactionRequest.dependencies||[])[0];if(!transactionDepJson){_context.next=15;break;}transactionDep=dnerojs.transactions.transactionFromJson(transactionDepJson);transactionDep.setFrom(fromAddress);_context.next=12;return this.getEstimatedGasData(transactionDep);case 12:depGasFeeData=_context.sent;transactionDepJson=_objectSpread(_objectSpread({},transactionDepJson),{},{txData:_objectSpread(_objectSpread({},transactionDepJson.txData),_.pick(depGasFeeData,['gasPrice','gasLimit'])),gasFeeData:depGasFeeData});transactionRequest.dependencies=[transactionDepJson];case 15:return _context.abrupt(\"return\",new Promise(function(resolve,reject){_this2._addTransactionRequest(Object.assign({},transactionRequest,{id:nanoid(),txData:_objectSpread(_objectSpread({},transactionRequest.txData),_.pick(gasFeeData,['gasPrice','gasLimit'])),gasFeeData:gasFeeData}),resolve,reject);}));case 16:case\"end\":return _context.stop();}}},_callee,this);}));function addTransactionRequest(_x){return _addTransactionRequest2.apply(this,arguments);}return addTransactionRequest;}()/**\n     * Validates and generates a txMeta with defaults and puts it in txStateManager\n     * store.\n     *\n     * @returns {Object}\n     */},{key:\"approveTransactionRequest\",value:function(){var _approveTransactionRequest=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(transactionRequestId,onDependencySent){var provider,approval,transactionRequest,fromAddress,transactionDepJson,transactionDep,transaction,result,_approval;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:provider=this._getProvider();approval=this.pendingTransactionRequests.get(transactionRequestId);transactionRequest=approval.request;fromAddress=this.preferencesController.getSelectedAddress();transactionDepJson=(transactionRequest.dependencies||[])[0];if(!transactionDepJson){_context2.next=10;break;}transactionDep=dnerojs.transactions.transactionFromJson(transactionDepJson);_context2.next=9;return this.signAndSendTransaction(fromAddress,transactionDep,provider);case 9:if(onDependencySent){onDependencySent();}case 10:transaction=dnerojs.transactions.transactionFromJson(transactionRequest);_context2.next=13;return this.signAndSendTransaction(fromAddress,transaction,provider);case 13:result=_context2.sent;if(!result){_context2.next=20;break;}_approval=this.pendingTransactionRequests.get(transactionRequestId);this._removeTransactionRequest(transactionRequestId);// Refresh balances because we just sent a tx\nthis._updateAccounts();_approval.resolve(result);return _context2.abrupt(\"return\",result);case 20:return _context2.abrupt(\"return\",true);case 21:case\"end\":return _context2.stop();}}},_callee2,this);}));function approveTransactionRequest(_x2,_x3){return _approveTransactionRequest.apply(this,arguments);}return approveTransactionRequest;}()/**\n     * Validates and generates a txMeta with defaults and puts it in txStateManager\n     * store.\n     *\n     * @returns {Object}\n     */},{key:\"rejectTransactionRequest\",value:function(){var _rejectTransactionRequest=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(transactionRequestId){var approval;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:this._removeTransactionRequest(transactionRequestId);approval=this.pendingTransactionRequests.get(transactionRequestId);// approval.reject(new Error('User rejected transaction.'));\nreturn _context3.abrupt(\"return\",true);case 3:case\"end\":return _context3.stop();}}},_callee3,this);}));function rejectTransactionRequest(_x4){return _rejectTransactionRequest.apply(this,arguments);}return rejectTransactionRequest;}()},{key:\"_transformTransaction\",value:function _transformTransaction(rawXact,priorityAddress){if(rawXact.type===dnerojs.constants.TxType.Send){var xact={};xact.type=rawXact.type;xact.number=rawXact.number;xact.status=rawXact.status;xact.hash=rawXact.hash.toLowerCase();xact.timestamp=rawXact.timestamp;xact.fee={dnero:rawXact.data.fee.dnerowei,dtoken:rawXact.data.fee.dtokenwei};xact.inputs=_.map(rawXact.data.inputs,function(input){return _.pick(input,['address','coins']);});xact.outputs=_.map(rawXact.data.outputs,function(output){return _.pick(output,['address','coins']);});//Sort outputs\nif(priorityAddress){var priorityAddressLC=priorityAddress.toLowerCase();xact.outputs=_.sortBy(xact.outputs,function(output){//Ensure the priorityAddress is always first (lowest sort key) in the list\nreturn priorityAddressLC===output.address.toLowerCase()?-100:0;});}return xact;}return null;}},{key:\"updateAccountTransactions\",value:function(){var _updateAccountTransactions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(address){var _this3=this;var txs,network,chainId,explorerUrl,explorerApiUrl,listStakesUrl,response,responseJson,_this$memStore$getSta,transactions;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:txs=null;if(!_.isEmpty(address)){_context4.next=3;break;}return _context4.abrupt(\"return\",[]);case 3:_context4.prev=3;network=this.preferencesController.getNetwork();chainId=network.chainId;explorerUrl=dnerojs.networks.getExplorerUrlForChainId(chainId);explorerApiUrl=\"\".concat(explorerUrl,\":8443/api\");listStakesUrl=\"\".concat(explorerApiUrl,\"/accounttx/\").concat(address);_context4.next=11;return fetch(listStakesUrl);case 11:response=_context4.sent;_context4.next=14;return response.json();case 14:responseJson=_context4.sent;txs=_.get(responseJson,['body'],[]);txs=_.map(txs,function(tx){return _this3._transformTransaction(tx,address);});txs=_.filter(txs,function(tx){return!_.isNil(tx);});_context4.next=23;break;case 20:_context4.prev=20;_context4.t0=_context4[\"catch\"](3);return _context4.abrupt(\"return\",[]);case 23:// update accounts state\n_this$memStore$getSta=this.memStore.getState(),transactions=_this$memStore$getSta.transactions;transactions[address]=txs;this.memStore.updateState({transactions:transactions});return _context4.abrupt(\"return\",txs);case 27:case\"end\":return _context4.stop();}}},_callee4,this,[[3,20]]);}));function updateAccountTransactions(_x5){return _updateAccountTransactions.apply(this,arguments);}return updateAccountTransactions;}()/**\n     * Estimates the gas fee\n     *\n     * @returns {Object}\n     */},{key:\"getEstimatedGasData\",value:function(){var _getEstimatedGasData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(transaction){var provider,result,gasLimitWithBuffer,gasLimit;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(transaction.getType()===dnerojs.constants.TxType.SmartContract)){_context5.next=12;break;}if(!(transaction.gasLimit!==dnerojs.constants.gasLimitDefault)){_context5.next=3;break;}return _context5.abrupt(\"return\",{gasPrice:transaction.gasPrice.toString(),gasLimit:transaction.gasLimit,totalGasFee:transaction.gasPrice.multipliedBy(transaction.gasLimit).toString()});case 3:provider=this._getProvider();_context5.next=6;return provider.callSmartContract(transaction);case 6:result=_context5.sent;// if(!_.isEmpty(result.vm_error)){\n//     throw new Error(result.vm_error);\n// }\ngasLimitWithBuffer=new BigNumber(result.gas_used).multipliedBy(1.5);gasLimit=Math.ceil(gasLimitWithBuffer.toNumber());return _context5.abrupt(\"return\",{gasPrice:dnerojs.constants.gasPriceSmartContractDefault.toString(),gasLimit:gasLimit,totalGasFee:dnerojs.constants.gasPriceSmartContractDefault.multipliedBy(gasLimit).toString()});case 12:return _context5.abrupt(\"return\",{gasPrice:dnerojs.constants.gasPriceDefault.toString(),totalGasFee:dnerojs.constants.gasPriceDefault.toString()});case 13:case\"end\":return _context5.stop();}}},_callee5,this);}));function getEstimatedGasData(_x6){return _getEstimatedGasData.apply(this,arguments);}return getEstimatedGasData;}()}]);return TransactionsController;}(EventEmitter);export{TransactionsController as default};","map":{"version":3,"names":["ObservableStore","dnerojs","nanoid","_","BigNumber","require","EventEmitter","TransactionsController","opts","initState","store","memStore","transactionRequests","transactions","preferencesController","signAndSendTransaction","_getProvider","getProvider","_updateAccounts","updateAccounts","pendingTransactionRequests","Map","getState","updateState","request","resolve","reject","_getTransactionRequests","push","_setTransactionRequests","set","id","transactionRequestId","filter","tx","find","transactionRequest","fromAddress","getSelectedAddress","transaction","transactionFromJson","setFrom","getEstimatedGasData","gasFeeData","transactionDepJson","dependencies","transactionDep","depGasFeeData","txData","pick","Promise","_addTransactionRequest","Object","assign","onDependencySent","provider","approval","get","result","_removeTransactionRequest","rawXact","priorityAddress","type","constants","TxType","Send","xact","number","status","hash","toLowerCase","timestamp","fee","dnero","data","dnerowei","dtoken","dtokenwei","inputs","map","input","outputs","output","priorityAddressLC","sortBy","address","txs","isEmpty","network","getNetwork","chainId","explorerUrl","networks","getExplorerUrlForChainId","explorerApiUrl","listStakesUrl","fetch","response","json","responseJson","_transformTransaction","isNil","getType","SmartContract","gasLimit","gasLimitDefault","gasPrice","toString","totalGasFee","multipliedBy","callSmartContract","gasLimitWithBuffer","gas_used","Math","ceil","toNumber","gasPriceSmartContractDefault","gasPriceDefault"],"sources":["/Users/jjestrella/DNERO_Protocol/dnerowebwallet/src/controllers/transactions.js"],"sourcesContent":["import ObservableStore from '../utils/ObservableStore';\nimport * as dnerojs from '@dnerolabs/dnero-js';\nimport {nanoid} from 'nanoid';\nimport _ from \"lodash\";\nimport BigNumber from \"bignumber.js\";\n\nconst { EventEmitter } = require('events');\n\nexport default class TransactionsController extends EventEmitter{\n    constructor(opts) {\n        super();\n\n        const initState = {\n            ...opts.initState,\n        };\n        this.store = new ObservableStore(initState);\n\n        this.memStore = new ObservableStore({\n            transactionRequests: [],\n            transactions: {}\n        });\n\n        this.preferencesController = opts.preferencesController;\n\n        this.signAndSendTransaction = opts.signAndSendTransaction;\n\n        this._getProvider = opts.getProvider;\n\n        this._updateAccounts = opts.updateAccounts;\n\n        this.pendingTransactionRequests = new Map();\n    }\n\n    _getTransactionRequests(){\n        return this.memStore.getState().transactionRequests || [];\n    }\n\n    _setTransactionRequests(transactionRequests){\n        this.memStore.updateState({\n            transactionRequests: transactionRequests\n        });\n    }\n\n    _addTransactionRequest(request, resolve, reject){\n        const transactionRequests = this._getTransactionRequests();\n        transactionRequests.push(request);\n        this._setTransactionRequests(transactionRequests);\n        this.pendingTransactionRequests.set(request.id, {\n            request: request,\n            resolve,\n            reject\n        });\n\n        return true;\n    }\n\n    _removeTransactionRequest(transactionRequestId){\n        let transactionRequests = this._getTransactionRequests();\n        transactionRequests = transactionRequests.filter((tx)=> {\n            return (tx.id !== transactionRequestId);\n        });\n\n        this._setTransactionRequests(transactionRequests);\n        delete this.pendingTransactionRequests[transactionRequestId];\n\n        return true;\n    }\n\n    _getTransactionRequest(transactionRequestId){\n        let transactionRequests = this._getTransactionRequests();\n        return  transactionRequests.find((tx)=> {\n            return (tx.id === transactionRequestId);\n        });\n    }\n\n    /**\n     * Validates and generates a txMeta with defaults and puts it in txStateManager\n     * store.\n     *\n     * @returns {Object}\n     */\n    async addTransactionRequest(transactionRequest) {\n        const fromAddress = this.preferencesController.getSelectedAddress();\n        const transaction = dnerojs.transactions.transactionFromJson(transactionRequest);\n        transaction.setFrom(fromAddress);\n        const gasFeeData = await this.getEstimatedGasData(transaction);\n        let transactionDepJson = (transactionRequest.dependencies || [])[0];\n\n        if(transactionDepJson){\n            const transactionDep = dnerojs.transactions.transactionFromJson(transactionDepJson);\n            transactionDep.setFrom(fromAddress);\n            const depGasFeeData = await this.getEstimatedGasData(transactionDep);\n            transactionDepJson = {\n                ...transactionDepJson,\n                txData: {\n                    ...transactionDepJson.txData,\n                    ..._.pick(depGasFeeData, ['gasPrice', 'gasLimit'])\n                },\n                gasFeeData: depGasFeeData\n            };\n            transactionRequest.dependencies = [transactionDepJson]\n        }\n\n        return new Promise((resolve, reject) => {\n            this._addTransactionRequest(Object.assign({}, transactionRequest, {\n                id: nanoid(),\n                txData: {\n                    ...transactionRequest.txData,\n                    ..._.pick(gasFeeData, ['gasPrice', 'gasLimit'])\n                },\n                gasFeeData: gasFeeData\n            }), resolve, reject);\n        });\n    }\n\n    /**\n     * Validates and generates a txMeta with defaults and puts it in txStateManager\n     * store.\n     *\n     * @returns {Object}\n     */\n    async approveTransactionRequest(transactionRequestId, onDependencySent) {\n        const provider = this._getProvider();\n        const approval = this.pendingTransactionRequests.get(transactionRequestId);\n        const transactionRequest = approval.request;\n        const fromAddress = this.preferencesController.getSelectedAddress();\n        const transactionDepJson = (transactionRequest.dependencies || [])[0];\n        if(transactionDepJson){\n            const transactionDep = dnerojs.transactions.transactionFromJson(transactionDepJson);\n            await this.signAndSendTransaction(fromAddress, transactionDep, provider);\n\n            if(onDependencySent){\n                onDependencySent();\n            }\n        }\n        const transaction = dnerojs.transactions.transactionFromJson(transactionRequest);\n        const result = await this.signAndSendTransaction(fromAddress, transaction, provider);\n\n        if(result){\n            const approval = this.pendingTransactionRequests.get(transactionRequestId);\n            this._removeTransactionRequest(transactionRequestId);\n\n            // Refresh balances because we just sent a tx\n            this._updateAccounts();\n\n            approval.resolve(result);\n\n            return result;\n        }\n\n        return true;\n    }\n\n    /**\n     * Validates and generates a txMeta with defaults and puts it in txStateManager\n     * store.\n     *\n     * @returns {Object}\n     */\n    async rejectTransactionRequest(transactionRequestId) {\n        this._removeTransactionRequest(transactionRequestId);\n        const approval = this.pendingTransactionRequests.get(transactionRequestId);\n        // approval.reject(new Error('User rejected transaction.'));\n\n        return true;\n    }\n\n    _transformTransaction(rawXact, priorityAddress) {\n        if (rawXact.type === dnerojs.constants.TxType.Send) {\n            let xact = {};\n\n            xact.type = rawXact.type;\n            xact.number = rawXact.number;\n            xact.status = rawXact.status;\n            xact.hash = rawXact.hash.toLowerCase();\n            xact.timestamp = rawXact.timestamp;\n            xact.fee = {\n                dnero: rawXact.data.fee.dnerowei,\n                dtoken: rawXact.data.fee.dtokenwei\n            };\n\n            xact.inputs = _.map(rawXact.data.inputs, (input) => {\n                return _.pick(input, ['address', 'coins']);\n            });\n            xact.outputs = _.map(rawXact.data.outputs, (output) => {\n                return _.pick(output, ['address', 'coins']);\n            });\n\n            //Sort outputs\n            if(priorityAddress){\n                var priorityAddressLC = priorityAddress.toLowerCase();\n\n                xact.outputs = _.sortBy(xact.outputs, function(output){\n                    //Ensure the priorityAddress is always first (lowest sort key) in the list\n                    return ((priorityAddressLC === output.address.toLowerCase()) ? -100 : 0);\n                });\n            }\n\n            return xact;\n        }\n\n        return null;\n    }\n\n    async updateAccountTransactions(address){\n        let txs = null;\n\n        if(_.isEmpty(address)){\n            return [];\n        }\n\n        try {\n            const network = this.preferencesController.getNetwork();\n            const chainId = network.chainId;\n            const explorerUrl = dnerojs.networks.getExplorerUrlForChainId(chainId);\n            const explorerApiUrl = `${explorerUrl}:8443/api`;\n            const listStakesUrl = `${explorerApiUrl}/accounttx/${address}`;\n            const response = await fetch(listStakesUrl);\n            const responseJson = await response.json();\n            txs = _.get(responseJson, ['body'], []);\n            txs = _.map(txs, (tx) => {\n                return this._transformTransaction(tx, address);\n            });\n            txs = _.filter(txs, (tx) => {\n                return !_.isNil(tx);\n            });\n        }\n        catch (e) {\n            // No Update\n            return [];\n        }\n\n        // update accounts state\n        const { transactions } = this.memStore.getState();\n        transactions[address] = txs;\n\n        this.memStore.updateState({\n            transactions: transactions\n        });\n\n        return txs;\n    }\n\n    /**\n     * Estimates the gas fee\n     *\n     * @returns {Object}\n     */\n    async getEstimatedGasData(transaction) {\n        if(transaction.getType() === dnerojs.constants.TxType.SmartContract){\n            if(transaction.gasLimit !== dnerojs.constants.gasLimitDefault){\n                // Gas fee was set by user...\n                return {\n                    gasPrice: transaction.gasPrice.toString(),\n                    gasLimit: transaction.gasLimit,\n                    totalGasFee: transaction.gasPrice.multipliedBy(transaction.gasLimit).toString()\n                }\n            }\n\n            const provider = this._getProvider();\n            const result = await provider.callSmartContract(transaction);\n\n            // if(!_.isEmpty(result.vm_error)){\n            //     throw new Error(result.vm_error);\n            // }\n\n            const gasLimitWithBuffer = (new BigNumber(result.gas_used)).multipliedBy(1.5);\n            const gasLimit = Math.ceil(gasLimitWithBuffer.toNumber());\n\n            return {\n                gasPrice: dnerojs.constants.gasPriceSmartContractDefault.toString(),\n                gasLimit: gasLimit,\n                totalGasFee: dnerojs.constants.gasPriceSmartContractDefault.multipliedBy(gasLimit).toString()\n            }\n        }\n        else{\n            return {\n                gasPrice: dnerojs.constants.gasPriceDefault.toString(),\n                totalGasFee: dnerojs.constants.gasPriceDefault.toString()\n            }\n        }\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}